<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Video + Modelo desde GitHub</title>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.10.0"></script>
</head>
<body>

<video id="video" width="224" height="224" autoplay></video>
<canvas id="canvas" width="28" height="28" style="display:none;"></canvas>

<script>
  const video = document.getElementById("video");
  const canvas = document.getElementById("canvas");
  const ctx = canvas.getContext("2d");

  const labels = ["Clase A", "Clase B", "Clase C"];
  let model;
  
  async function setupCamera() {
    const stream = await navigator.mediaDevices.getUserMedia({
      video: { width: 224, height: 224 }
    });
    video.srcObject = stream;
    return new Promise(resolve => {
      video.onloadedmetadata = () => resolve(video);
    });
  }

  async function loadModel() {
    console.log("Cargando modelo...");
    model = await tf.loadLayersModel(./model.json);
    console.log("Modelo cargado correctamente");
  }

  async function classifyFrame() {
    ctx.drawImage(canvas, 0, 0, 28, 28);

    const inputTensor = tf.tidy(() =>
      tf.browser
        .fromPixels(canvas)
        .toFloat()
        .div(255.0)
        .expandDims(0)
    );

    const prediction = model.predict(inputTensor);
    const probs = await prediction.data();

    const maxIndex = probs.indexOf(Math.max(...probs));
    console.log(
      "Clase:",
      labels[maxIndex],
      "Probabilidades:",
      probs
    );

    tf.dispose([inputTensor, prediction]);
    requestAnimationFrame(classifyFrame);
  }
  
  async function main() {
    await setupCamera();
    await loadModel();
    classifyFrame();
  }

  main();
</script>

</body>
</html>




