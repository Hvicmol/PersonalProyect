<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Reconocimiento con IA</title>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.15.0/dist/tf.min.js"></script>

<style>
body { font-family: Arial; text-align: center; }
video { border: 1px solid #ccc; }
</style>
</head>

<body>

<video id="video" width="320" height="240" autoplay></video>
<canvas id="canvas" width="28" height="28" style="display:none;"></canvas>

<br>
<button id="start">Iniciar</button>
<button id="stop">Detener</button>

<div id="result">Cargando modelo...</div>

<script>
const video = document.getElementById('video');
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const resultDiv = document.getElementById('result');

let model;
let intervalId;

async function loadModel() {
    try {
        predictionBox.textContent = "Cargando modelo...";
        await tf.setBackend("cpu");
        await tf.ready();
        model = await tf.loadLayersModel("./modelo.json");
        predictionBox.textContent = "Modelo cargado correctamente";
    } catch (err) {
        predictionBox.textContent =
            "Error cargando modelo: " + err.message;
    }
}


loadModel();

navigator.mediaDevices.getUserMedia({ video: true })
.then(stream => video.srcObject = stream)
.catch(() => resultDiv.textContent = 'Error al acceder a la cámara');

function predict() {
    ctx.drawImage(video, 0, 0, 28, 28);

let img = tf.browser.fromPixels(canvas, 1)
    .resizeNearestNeighbor([28, 28])
    .toFloat()
    .div(255.0)
    .expandDims(0);

    const prediction = model.predict(img);
    const data = prediction.dataSync();

    const max = Math.max(...data);
    const index = data.indexOf(max);

    resultDiv.textContent =
        `Clase: ${index} — Confianza: ${(max * 100).toFixed(2)}%`;

    tf.dispose([img, prediction]);
}

document.getElementById('start').onclick = () => {
    intervalId = setInterval(predict, 1000);
};

document.getElementById('stop').onclick = () => {
    clearInterval(intervalId);
};
</script>

</body>
</html>











